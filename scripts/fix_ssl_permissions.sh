#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ SSL —Ñ–∞–π–ª–∞–º –≤ WSL

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ SSL —Ñ–∞–π–ª–∞–º –¥–ª—è WSL..."

SSL_DIR="ssl"

if [ ! -d "$SSL_DIR" ]; then
    echo "‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è ssl/ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:"
    echo "   ./scripts/generate_ssl_certs.sh"
    exit 1
fi

cd "$SSL_DIR"

echo "üìÅ –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º..."

# –ü—Ä–∞–≤–∞ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –∫–ª—é—á–µ–π
chmod 644 *.jks 2>/dev/null || echo "‚ö†Ô∏è JKS —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
chmod 644 *.properties 2>/dev/null || echo "‚ö†Ô∏è Properties —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
chmod 644 ca-cert 2>/dev/null || echo "‚ö†Ô∏è CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"
chmod 600 ca-key 2>/dev/null || echo "‚ö†Ô∏è CA –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω"
chmod 644 *-cert-* 2>/dev/null || echo "‚ö†Ô∏è –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

# –ü—Ä–∞–≤–∞ –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
chmod 755 .

cd ..

echo "‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!"

echo ""
echo "üìã –¢–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:"
ls -la ssl/ | head -10

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Ñ–∞–π–ª–æ–≤:"
python3 scripts/test_ssl_connection.py 